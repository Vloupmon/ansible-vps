---

- name: Create drone dir
  file:
    path: $HOME/drone
    state: directory

- name: Copy drone docker-compose
  copy:
    src: docker-compose.yml
    dest: $HOME/drone/docker-compose.yml

- name: docker compose up -d
  vars:
    github_client_id: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          64386234366564616237336439626431373735373733656563666433343233363265626133616638
          3162313361356131313965613230316438336332653933310a373264656563666565396336383136
          39376130363037383735373834386336393330333163333332623338363162666130333261383737
          6465396165646364350a356337666565336330393436643133303830363435383061316139653936
          62656230653565633639333437346238313763663538323530356630336335383861
    github_client_secret: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          36363362366233663235633139666136653537616164303133323839363531633261656565376530
          6332313565633633363161633833386430616435616266660a376265663235656664373137663938
          61633265353761346162316332613236333539313532303330663865623465343739343830323262
          3461333564363832620a333231353861366430343461343162616262346137396532353734343934
          37666431366139326237303136623233373165316135623737393731313163316334346235633531
          3062376133643930636535656630643433646138316339663239
    drone_rpc_secret: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          66356531363233383366396564643235386661386564636337613532333464633232333963326166
          6533383839346435656439366264333662623462313835340a383435633834643662663932653535
          30333662353762613532336130383562356336656464386435356635343665396239336333346335
          3331323339313361390a323331316662363730636437393334363766316563616562626438313036
          33613963333932373932383338633635356233303735303135653930653164333365656536323937
          6633303830656362623462363231643038323263346662633963
  shell: |
    export GITHUB_CLIENT_ID="{{ github_client_id }}"
    export GITHUB_CLIENT_SECRET="{{ github_client_secret }}"
    export DRONE_RPC_SECRET="{{ drone_rpc_secret }}"
    export HOSTNAME="{{ hostname }}"
    cd $HOME/drone && docker-compose up -d
