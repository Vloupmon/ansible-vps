---
- name: Create new user for www uploads
  become: yes
  shell: useradd -m www_uploads
  ignore_errors: yes

- name: Create www_uploads user files
  become: yes
  shell: mkdir -p /home/www_uploads/.ssh/ && touch /home/www_uploads/.ssh/authorized_keys && chown www_uploads:www_uploads -R /home/www_uploads/ && chmod 700 /home/www_uploads/.ssh && chmod 600 /home/www_uploads/.ssh/authorized_keys

- name: Generate authorized_keys with pubkey
  vars:
    pubkey: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          35633434383330666438393762326436333837353165656639326330663934616135623338366332
          3736346434363837323532366336373863623534356366340a396565333532346266356634343736
          65353839393065373037393334636532616232313862343532303738633339653332333364363333
          3139393563346630310a323136343864333931623266666437666566623335333039373831303163
          32303062363132613134383333646534313532386437366362356662663737363735333135343230
          39353431633735383037396439633065636231653366353065316531346432656366373561636662
          34383038326339323030316432356135353861303635363064353238366331626235366563333436
          65323831613131643339396236366630336565633932663931346234633937343264396561396433
          66656236643432656530393938666231376630383635353431653362316361646363666163386333
          36653536653931326361613865623164626166316136383166663162346634393739303233323866
          66353636643064396237656364376230656433373438616635663932636330633335623738633432
          31353738313263336536333637636561363466393165376533373838303032623865346137393465
          66653431653162316266663563346133613638613436383965636166353033613932363139666662
          63663232373365323636643831343032306530346532613835376635366665323831396161323430
          64666463666330353266653666336335653739613438306338346635373231363939656532633730
          65343338663930386265613939393037336334653836336530356563356436366665653438306639
          35333635653562613566363762663364363337353165346337333161643166396437333330383064
          37613665613863346666616539613030653835306461323139373236363431396536303235326466
          65623530633935613833373036376434336339643339303639333862616533616437303933366232
          39636164383834356166623634316137313364643631373938656530346334373833386138373363
          34653363346262343437653137333061643331343161353139646161326337663939626234323433
          30643164643264393966383337653562383466346637313166383137623032356434383966663666
          32653336343831303464383938663963396661613066346338373162333534383539616633343633
          32636535343962393938623461316439666537663665336637346566333161663562366631346564
          3266
  become: yes
  shell: echo "{{ pubkey }}" > /home/www_uploads/.ssh/authorized_keys

- name: Create www dir with www_uploads user access
  become: yes
  shell: mkdir -p /var/www/html/ && setfacl -m u:www_uploads:rwx -Rd /var/www/html

- name: Copy resume to www files
  become: yes
  copy:
    src: resume.pdf
    dest: /var/www/html/resume.pdf
